<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Documentation | Weekly Timesheet Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Code+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        /* Simple style for the active nav link */
        .nav-link.active {
            color: #2563eb; /* blue-600 */
            font-weight: 600;
            border-left-color: #2563eb; /* blue-600 */
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Source Code Pro', 'monospace'],
                    },
                    // Custom typography styles to change code color
                    typography: ({ theme }) => ({
                        DEFAULT: {
                            css: {
                                'code': {
                                    color: theme('colors.indigo.600'),
                                    fontWeight: '500',
                                },
                                'code::before': { content: '""' },
                                'code::after': { content: '""' },
                            },
                        },
                    }),
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 font-sans text-gray-700 antialiased">

    <div class="relative lg:grid lg:grid-cols-[280px_1fr] min-h-screen">
        <aside class="hidden lg:block fixed top-0 left-0 h-full w-[280px] bg-white border-r border-gray-200 p-8">
            <h3 class="text-sm font-semibold tracking-wide text-gray-900 uppercase">On this page</h3>
            <nav class="mt-4">
                <ul id="desktop-nav-links" class="space-y-2 text-gray-500">
                    <li><a href="#overview" class="nav-link block border-l-2 border-transparent pl-4 py-1 hover:text-blue-600 hover:border-blue-600 transition-colors">Overview</a></li>
                    <li><a href="#architecture" class="nav-link block border-l-2 border-transparent pl-4 py-1 hover:text-blue-600 hover:border-blue-600 transition-colors">Architecture & Data Flow</a></li>
                    <li><a href="#configuration" class="nav-link block border-l-2 border-transparent pl-4 py-1 hover:text-blue-600 hover:border-blue-600 transition-colors">Analysis Configuration</a></li>
                    <li><a href="#flags" class="nav-link block border-l-2 border-transparent pl-4 py-1 hover:text-blue-600 hover:border-blue-600 transition-colors">Visual Flags & Legend</a></li>
                    <li><a href="#functions" class="nav-link block border-l-2 border-transparent pl-4 py-1 hover:text-blue-600 hover:border-blue-600 transition-colors">Key JavaScript Functions</a></li>
                    <li><a href="#dependencies" class="nav-link block border-l-2 border-transparent pl-4 py-1 hover:text-blue-600 hover:border-blue-600 transition-colors">Dependencies</a></li>
                </ul>
            </nav>
        </aside>

        <div class="lg:col-start-2">
            <div class="container mx-auto max-w-3xl px-4 sm:px-6 lg:px-8">
                <div class="my-12 sm:my-16 lg:my-20">
                    
                    <header class="mb-16">
                        <h1 class="text-4xl sm:text-5xl font-bold tracking-tighter text-gray-900">Technical Documentation</h1>
                        <p class="mt-3 text-lg sm:text-xl text-gray-500">Weekly Timesheet Anomaly Detection Dashboard</p>
                    </header>

                    <main class="space-y-20">

                        <section id="overview">
                            <h2 class="text-3xl font-bold tracking-tight text-gray-900 mb-8">1. Overview</h2>
                            <div class="prose prose-lg max-w-none prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline">
                                <p>
                                    This document outlines the technical details of the <strong>Weekly Timesheet Dashboard</strong>, a single-page web application designed to run within a Google Apps Script environment. The application fetches timesheet data from a Google Sheet, processes it to identify potential anomalies, and displays it in a user-friendly weekly report format. The frontend is built with vanilla JavaScript and HTML, and is styled with Tailwind CSS. It performs all data processing, analysis, and rendering client-side after receiving the raw data from the Google Apps Script backend.
                                </p>
                            </div>
                        </section>

                        <section id="architecture">
                            <h2 class="text-3xl font-bold tracking-tight text-gray-900 mb-8">2. Architecture & Data Flow</h2>
                            <div class="relative pl-8">
                                <div class="absolute left-[34px] top-12 bottom-12 w-0.5 bg-gray-200"></div>
                                <div class="space-y-12">
                                    <div class="relative flex items-start gap-6">
                                        <div class="flex-shrink-0 w-12 h-12 bg-white border-2 border-blue-500 rounded-full flex items-center justify-center font-bold text-blue-500 z-10">1</div>
                                        <div class="pt-2">
                                            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                                <i class="material-icons text-gray-500">web</i>
                                                Initial Load (Client)
                                            </h3>
                                            <p class="mt-1 text-gray-600">User opens the web app URL. The <code>index.html</code> file is served.</p>
                                        </div>
                                    </div>
                                    <div class="relative flex items-start gap-6">
                                        <div class="flex-shrink-0 w-12 h-12 bg-white border-2 border-blue-500 rounded-full flex items-center justify-center font-bold text-blue-500 z-10">2</div>
                                        <div class="pt-2">
                                            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                                <i class="material-icons text-gray-500">http</i>
                                                Data Fetching (Client → Server)
                                            </h3>
                                            <p class="mt-1 text-gray-600">Client-side JavaScript calls <code>google.script.run</code> to asynchronously request data.</p>
                                        </div>
                                    </div>
                                    <div class="relative flex items-start gap-6">
                                        <div class="flex-shrink-0 w-12 h-12 bg-white border-2 border-indigo-500 rounded-full flex items-center justify-center font-bold text-indigo-500 z-10">3</div>
                                        <div class="pt-2">
                                            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                                <i class="material-icons text-gray-500">dns</i>
                                                Backend Processing (Server)
                                            </h3>
                                            <p class="mt-1 text-gray-600">The <code>getDashboardData()</code> function in <code>Code.gs</code> reads data from the Google Sheet.</p>
                                        </div>
                                    </div>
                                    <div class="relative flex items-start gap-6">
                                        <div class="flex-shrink-0 w-12 h-12 bg-white border-2 border-indigo-500 rounded-full flex items-center justify-center font-bold text-indigo-500 z-10">4</div>
                                        <div class="pt-2">
                                            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                                <i class="material-icons text-gray-500">unarchive</i>
                                                Data Return (Server → Client)
                                            </h3>
                                            <p class="mt-1 text-gray-600">The server returns the raw timesheet data as a JSON-like object.</p>
                                        </div>
                                    </div>
                                     <div class="relative flex items-start gap-6">
                                        <div class="flex-shrink-0 w-12 h-12 bg-white border-2 border-blue-500 rounded-full flex items-center justify-center font-bold text-blue-500 z-10">5</div>
                                        <div class="pt-2">
                                            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                                <i class="material-icons text-gray-500">input</i>
                                                Client-Side Handling
                                            </h3>
                                            <p class="mt-1 text-gray-600">The <code>onDataSuccess</code> callback is triggered, storing the fetched data.</p>
                                        </div>
                                    </div>
                                     <div class="relative flex items-start gap-6">
                                        <div class="flex-shrink-0 w-12 h-12 bg-white border-2 border-blue-500 rounded-full flex items-center justify-center font-bold text-blue-500 z-10">6</div>
                                        <div class="pt-2">
                                            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                                <i class="material-icons text-gray-500">grid_view</i>
                                                UI Initialization
                                            </h3>
                                            <p class="mt-1 text-gray-600">The loader is hidden, filters are populated, and the initial report generation begins.</p>
                                        </div>
                                    </div>
                                    <div class="relative flex items-start gap-6">
                                        <div class="flex-shrink-0 w-12 h-12 bg-white border-2 border-blue-500 rounded-full flex items-center justify-center font-bold text-blue-500 z-10">7</div>
                                        <div class="pt-2">
                                            <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                                <i class="material-icons text-gray-500">analytics</i>
                                                Analysis & Rendering
                                            </h3>
                                            <p class="mt-1 text-gray-600">Data is filtered, processed by <code>processDataForWeek</code>, and rendered into HTML.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section id="configuration">
                            <h2 class="text-3xl font-bold tracking-tight text-gray-900 mb-8">3. Analysis Configuration</h2>
                            <div class="prose prose-lg max-w-none mb-6">
                                <p>
                                    The core analysis logic is controlled by several constants defined at the top of the client-side script. These values can be tuned to adjust the sensitivity of the anomaly detection.
                                </p>
                            </div>
                            <div class="overflow-x-auto rounded-lg border border-gray-200 bg-white shadow-sm">
                                <table class="w-full text-left text-base">
                                    <thead class="bg-gray-50 text-gray-800 font-semibold">
                                        <tr>
                                            <th class="p-4">Constant Name</th>
                                            <th class="p-4">Default Value</th>
                                            <th class="p-4">Description</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <tr>
                                            <td class="p-4 font-mono text-sm text-indigo-600 font-medium">HOME_PROXIMITY_METERS</td>
                                            <td class="p-4 font-mono text-sm">200</td>
                                            <td class="p-4 text-gray-600">The radius (in meters) around a rep's home to be considered "Near Home".</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 font-mono text-sm text-indigo-600 font-medium">CENTER_PROXIMITY_METERS</td>
                                            <td class="p-4 font-mono text-sm">200</td>
                                            <td class="p-4 text-gray-600">The radius (in meters) around a business center to be considered "At Center".</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 font-mono text-sm text-indigo-600 font-medium">REPEATED_LOCATION_RADIUS_METERS</td>
                                            <td class="p-4 font-mono text-sm">50</td>
                                            <td class="p-4 text-gray-600">The radius used to group multiple events into a single location cluster.</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 font-mono text-sm text-indigo-600 font-medium">REPEATED_LOCATION_THRESHOLD</td>
                                            <td class="p-4 font-mono text-sm">5</td>
                                            <td class="p-4 text-gray-600">Minimum events in a cluster to be flagged as a "Repeated Location".</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 font-mono text-sm text-indigo-600 font-medium">SUSPICIOUS_TIME_WINDOW_SECONDS</td>
                                            <td class="p-4 font-mono text-sm">60</td>
                                            <td class="p-4 text-gray-600">Time window (seconds) for detecting suspiciously similar check-in/out times.</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 font-mono text-sm text-indigo-600 font-medium">SUSPICIOUS_TIME_THRESHOLD</td>
                                            <td class="p-4 font-mono text-sm">3</td>
                                            <td class="p-4 text-gray-600">Minimum number of days with similar times to trigger a "Time Anomaly" flag.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </section>
                        
                        <section id="flags">
                            <h2 class="text-3xl font-bold tracking-tight text-gray-900 mb-8">4. Visual Flags & Legend</h2>
                            <div class="prose prose-lg max-w-none mb-8">
                                <p>
                                    To provide at-a-glance insights, the dashboard uses a system of color-coded flags. These flags appear next to events and provide immediate context for potential anomalies.
                                </p>
                            </div>
                            <div class="space-y-6">
                                <div class="flex items-start gap-4">
                                    <i class="material-icons text-blue-500 mt-1 text-2xl">schedule</i>
                                    <div>
                                        <b class="text-lg font-semibold text-gray-900">Time Anomaly</b>
                                        <code class="ml-2 !text-xs !font-bold bg-blue-100 text-blue-800 rounded-full px-2 py-1">isSuspiciousTime</code>
                                        <p class="text-gray-600 mt-1">Indicates that the check-in or out time is suspiciously similar on 3 or more days in the week.</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <i class="material-icons text-purple-500 mt-1 text-2xl">repeat</i>
                                    <div>
                                        <b class="text-lg font-semibold text-gray-900">Repeated (Home)</b>
                                        <code class="ml-2 !text-xs !font-bold bg-purple-100 text-purple-800 rounded-full px-2 py-1">isRepeatedLocationHome</code>
                                        <p class="text-gray-600 mt-1">Flags 5+ events clustered in the same location, which is also near the rep's home base.</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                     <i class="material-icons text-teal-500 mt-1 text-2xl">pin_drop</i>
                                    <div>
                                        <b class="text-lg font-semibold text-gray-900">Repeated (Away)</b>
                                        <code class="ml-2 !text-xs !font-bold bg-teal-100 text-teal-800 rounded-full px-2 py-1">isRepeatedLocationAway</code>
                                        <p class="text-gray-600 mt-1">Flags 5+ events clustered in the same location, but away from the rep's home base.</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <i class="material-icons text-orange-500 mt-1 text-2xl">home</i>
                                    <div>
                                        <b class="text-lg font-semibold text-gray-900">Near Home</b>
                                        <code class="ml-2 !text-xs !font-bold bg-orange-100 text-orange-800 rounded-full px-2 py-1">isNearHome</code>
                                        <p class="text-gray-600 mt-1">The event occurred within 200m of the rep's designated home base.</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <i class="material-icons text-red-500 mt-1 text-2xl">warning</i>
                                    <div>
                                        <b class="text-lg font-semibold text-gray-900">Far From Center</b>
                                        <code class="ml-2 !text-xs !font-bold bg-red-100 text-red-800 rounded-full px-2 py-1">isFarFromCenter</code>
                                        <p class="text-gray-600 mt-1">The event is over 200m from the nearest known business center location.</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <i class="material-icons text-green-500 mt-1 text-2xl">location_on</i>
                                    <div>
                                        <b class="text-lg font-semibold text-gray-900">At Center</b>
                                        <code class="ml-2 !text-xs !font-bold bg-green-100 text-green-800 rounded-full px-2 py-1">isAtCenter</code>
                                        <p class="text-gray-600 mt-1">The event occurred within 200m of a known business center location.</p>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section id="functions">
                            <h2 class="text-3xl font-bold tracking-tight text-gray-900 mb-8">5. Key JavaScript Functions</h2>
                            <div class="prose prose-lg max-w-none mb-6">
                                <p>The application's client-side logic is organized into several key functions, each with a distinct responsibility. The table below outlines these functions and their purposes.</p>
                            </div>
                            <div class="overflow-x-auto rounded-lg border border-gray-200 bg-white shadow-sm">
                                <table class="w-full text-left text-base">
                                    <thead class="bg-gray-50 text-gray-800 font-semibold">
                                        <tr>
                                            <th class="p-4 w-1/6">Category</th>
                                            <th class="p-4 w-1/4">Function Signature</th>
                                            <th class="p-4">Description</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <tr>
                                            <td class="p-4 align-top font-medium text-gray-800">Data Entry Point</td>
                                            <td class="p-4 align-top"><code class="font-mono !text-sm !font-medium">onDataSuccess(dataObject)</code></td>
                                            <td class="p-4 align-top text-gray-600">The primary callback triggered after fetching data. It validates and stores data, populates UI filters, and starts the initial report generation.</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 align-top font-medium text-gray-800">UI Orchestrator</td>
                                            <td class="p-4 align-top"><code class="font-mono !text-sm !font-medium">generateReport()</code></td>
                                            <td class="p-4 align-top text-gray-600">Orchestrates the report creation by reading filter values and calling the processing and rendering functions for each selected representative.</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 align-top font-medium text-gray-800">Core Analysis Engine</td>
                                            <td class="p-4 align-top"><code class="font-mono !text-sm !font-medium">processDataForWeek(...)</code></td>
                                            <td class="p-4 align-top text-gray-600">The heart of the logic. It takes raw data for a single rep and performs all calculations and analysis for the week, returning an object with insights and flags.</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 align-top font-medium text-gray-800">UI Rendering</td>
                                            <td class="p-4 align-top"><code class="font-mono !text-sm !font-medium">renderWeeklyReport(...)</code></td>
                                            <td class="p-4 align-top text-gray-600">Takes processed data and generates the final HTML for a weekly report, creating the grid of day cards and populating them with details and flags.</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 align-top font-medium text-gray-800" rowspan="4">Utility Functions</td>
                                            <td class="p-4 align-top"><code class="font-mono !text-sm !font-medium">getDistance(coords1, coords2)</code></td>
                                            <td class="p-4 align-top text-gray-600">Calculates the Haversine distance in meters.</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 align-top"><code class="font-mono !text-sm !font-medium">findNearestCenter(targetLatLong)</code></td>
                                            <td class="p-4 align-top text-gray-600">Finds the closest business center to a given event.</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 align-top"><code class="font-mono !text-sm !font-medium">formatDate(dateString)<br>formatTime(timeValue)</code></td>
                                            <td class="p-4 align-top text-gray-600">Standardize date and time display format.</td>
                                        </tr>
                                        <tr>
                                            <td class="p-4 align-top"><code class="font-mono !text-sm !font-medium">getWeekOfMonth(date)</code></td>
                                            <td class="p-4 align-top text-gray-600">A custom function to determine the week number within a month.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </section>

                        <section id="dependencies">
                            <h2 class="text-3xl font-bold tracking-tight text-gray-900 mb-8">6. Dependencies</h2>
                            <div class="prose prose-lg max-w-none">
                                <p class="!mb-5">The project relies on a few external libraries, all loaded via CDN for simplicity.</p>
                                <ul class="!mt-4 space-y-2">
                                    <li><strong>Tailwind CSS</strong> For all styling and layout.</li>
                                    <li><strong>Google Fonts (Inter & Source Code Pro)</strong> For typography.</li>
                                    <li><strong>Google Material Icons</strong> For UI icons.</li>
                                    <li><strong>Leaflet.js</strong> For the interactive map modal.</li>
                                </ul>
                            </div>
                        </section>

                    </main>

                    <footer class="mt-20 pt-8 border-t border-gray-300 text-center text-sm text-gray-500">
                        <p>Documentation generated on <span id="generation-date" class="font-medium"></span></p>
                    </footer>

                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('generation-date').textContent = new Date().toUTCString();

            const sections = document.querySelectorAll('main section');
            const navLinks = document.querySelectorAll('.nav-link');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                        });
                    }
                });
            }, { rootMargin: "-50% 0px -50% 0px" }); // Activate when section is in the middle of the viewport

            sections.forEach(section => {
                observer.observe(section);
            });
        });
    </script>
</body>
</html>